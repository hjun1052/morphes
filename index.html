<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MORPHES</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="app-loading">
    <!-- 메인 애플리케이션 -->
    <div id="app-page">
        <!-- 사이드바 -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo-small">
                    <img src="logo.png" alt="MORPHES Logo" width="48" height="48">
                    <span>MORPHES</span>
                </div>
                <div class="new-chat-group">
                    <button class="btn-new-chat" id="new-chat-btn">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M10 4V16M4 10H16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        새 대화
                    </button>
                    <button class="btn-chat-dropdown" id="project-menu-toggle" aria-label="프로젝트 메뉴">
                        ▼
                    </button>
                    <div class="project-menu hidden" id="project-menu">
                        <button type="button" id="project-menu-create">새 프로젝트 만들기</button>
                        <button type="button" id="project-menu-manage">프로젝트 관리</button>
                    </div>
                </div>
            </div>
            
            <div class="sidebar-scroll">
                <div class="project-sidebar" id="project-sidebar">
                    <!-- 프로젝트 폴더 목록 -->
                </div>
                <div class="chat-history" id="chat-history">
                    <!-- 대화 기록이 여기에 동적으로 추가됩니다 -->
                </div>
            </div>
            
            <div class="sidebar-footer">
                <button class="sidebar-btn sidebar-upgrade" id="upgrade-btn">
                    <div class="sidebar-upgrade-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M12 4L14.5 10.5L21 11L16 15L17.5 21L12 17.75L6.5 21L8 15L3 11L9.5 10.5L12 4Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="sidebar-upgrade-text">
                        <span class="title">Pro로 업그레이드</span>
                        <span class="subtitle">무제한 재작성</span>
                    </div>
                </button>
                <button class="sidebar-btn" id="library-btn">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M5 4H15V16H5V4Z" stroke="currentColor" stroke-width="1.5"/>
                        <path d="M8 7H12" stroke="currentColor" stroke-width="1.5"/>
                        <path d="M8 10H12" stroke="currentColor" stroke-width="1.5"/>
                    </svg>
                    라이브러리
                </button>
                <button class="sidebar-btn" id="gallery-btn">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <circle cx="6" cy="7" r="2" stroke="currentColor" stroke-width="1.5"/>
                        <path d="M2 16L7 11L10 14L13.5 10.5L18 15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                    </svg>
                    탐색
                </button>
                <button class="sidebar-btn" id="settings-btn">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M10 12.5C11.3807 12.5 12.5 11.3807 12.5 10C12.5 8.61929 11.3807 7.5 10 7.5C8.61929 7.5 7.5 8.61929 7.5 10C7.5 11.3807 8.61929 12.5 10 12.5Z" stroke="currentColor" stroke-width="1.5"/>
                        <path d="M16.25 10C16.25 10.4375 16.2188 10.8438 16.1875 11.25L18.0938 12.6875C18.25 12.8125 18.2812 13.0625 18.1875 13.25L16.4062 16.25C16.3125 16.4375 16.0938 16.5 15.9062 16.4375L13.6562 15.5625C13.2188 15.9062 12.75 16.1875 12.2188 16.4062L11.875 18.7812C11.8438 19 11.6562 19.1562 11.4375 19.1562H7.875C7.65625 19.1562 7.46875 19 7.4375 18.7812L7.09375 16.4062C6.5625 16.1875 6.09375 15.9062 5.65625 15.5625L3.40625 16.4375C3.21875 16.5 3 16.4375 2.90625 16.25L1.125 13.25C1.03125 13.0625 1.0625 12.8125 1.21875 12.6875L3.125 11.25C3.09375 10.8438 3.0625 10.4375 3.0625 10C3.0625 9.5625 3.09375 9.15625 3.125 8.75L1.21875 7.3125C1.0625 7.1875 1.03125 6.9375 1.125 6.75L2.90625 3.75C3 3.5625 3.21875 3.5 3.40625 3.5625L5.65625 4.4375C6.09375 4.09375 6.5625 3.8125 7.09375 3.59375L7.4375 1.21875C7.46875 1 7.65625 0.84375 7.875 0.84375H11.4375C11.6562 0.84375 11.8438 1 11.875 1.21875L12.2188 3.59375C12.75 3.8125 13.2188 4.09375 13.6562 4.4375L15.9062 3.5625C16.0938 3.5 16.3125 3.5625 16.4062 3.75L18.1875 6.75C18.2812 6.9375 18.25 7.1875 18.0938 7.3125L16.1875 8.75C16.2188 9.15625 16.25 9.5625 16.25 10Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    설정
                </button>
            </div>
        </aside>
        <div class="sidebar-overlay" id="sidebar-overlay"></div>

        <!-- 메인 컨텐츠 -->
        <main class="main-content">
            <div class="chat-container">
                <!-- 채팅 헤더 -->
                <div class="chat-header">
                    <button class="btn-toggle-sidebar" id="toggle-sidebar">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M3 12H21M3 6H21M3 18H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </button>
                    
                    <div class="service-selector">
                        <label for="ai-service">
                            <span class="label-desktop">대상 AI 서비스</span>
                            <span class="label-mobile">대상</span>
                        </label>
                        <select id="ai-service" class="service-dropdown">
                            <option value="chatgpt">ChatGPT</option>
                            <option value="claude">Claude</option>
                            <option value="gemini">Gemini</option>
                            <option value="perplexity">Perplexity</option>
                        </select>
                    </div>
                </div>

                <!-- 채팅 메시지 영역 -->
                <div class="messages-container" id="messages-container">
                    <div class="welcome-screen" id="welcome-screen">
                        <div class="welcome-icon">
                            <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
                                <rect width="64" height="64" rx="16" fill="#FFF5F0"/>
                                <path d="M21 18L32 32L21 46M35 46H48" stroke="#FF6B35" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <h2>MORPHES에 오신 것을 환영합니다</h2>
                        <p>원하시는 프롬프트를 자연스러운 대화로 만들어보세요</p>
                        <div class="example-prompts">
                            <button class="example-prompt" data-prompt="블로그 글 작성 프롬프트 만들기">블로그 글 작성 프롬프트 만들기</button>
                            <button class="example-prompt" data-prompt="코드 리뷰 프롬프트 생성">코드 리뷰 프롬프트 생성</button>
                            <button class="example-prompt" data-prompt="데이터 분석 도우미 프롬프트">데이터 분석 도우미 프롬프트</button>
                            <button class="example-prompt" data-prompt="창의적 글쓰기 프롬프트">창의적 글쓰기 프롬프트</button>
                        </div>
                        <div class="suggested-section">
                            <h3>추천 항목</h3>
                            <div class="suggested-grid">
                                <button class="suggested-card" data-prompt="콘텐츠 마케팅 팀을 위한 4주 분량 SNS 캠페인 브리프 작성">
                                    <span class="suggested-title">콘텐츠 마케팅 브리프</span>
                                    <span class="suggested-description">SNS 채널별 핵심 메시지와 KPI 정의</span>
                                </button>
                                <button class="suggested-card" data-prompt="신규 SaaS 제품 출시를 위한 이메일 런칭 시퀀스를 설계">
                                    <span class="suggested-title">제품 런칭 시퀀스</span>
                                    <span class="suggested-description">사전 홍보·런칭·후속 메일까지 구성</span>
                                </button>
                                <button class="suggested-card" data-prompt="사내 워크샵 진행자를 위한 아이스브레이킹 질문 리스트 작성">
                                    <span class="suggested-title">워크샵 아이스브레이킹</span>
                                    <span class="suggested-description">팀 빌딩용 질문 세트 10개 추천</span>
                                </button>
                                <button class="suggested-card" data-prompt="고객 인터뷰 기록을 분석하여 주요 인사이트와 행동 항목 도출">
                                    <span class="suggested-title">고객 인터뷰 분석</span>
                                    <span class="suggested-description">인사이트·진행상 문제·다음 단계 요약</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="project-view hidden" id="project-view"></div>
                </div>

                <!-- 입력 영역 -->
                <div class="input-container">
                    <div class="attachment-bar hidden" id="attachment-bar"></div>
                    <form id="chat-form" class="chat-form">
                        <div class="attach-controls">
                            <button 
                                type="button" 
                                class="btn-attach btn-attach-main" 
                                id="attach-menu-toggle" 
                                title="첨부 메뉴 열기" 
                                aria-haspopup="true" 
                                aria-expanded="false"
                            >
                                +
                            </button>
                            <input type="file" id="chat-attachment" multiple hidden>
                            <div class="attach-menu hidden" id="attach-menu" role="menu">
                                <button type="button" data-attach-action="upload">📁 파일 업로드</button>
                                <button type="button" data-attach-action="link">🔗 링크에서 가져오기</button>
                                <button type="button" data-attach-action="github">🐙 깃허브에서 가져오기</button>
                            </div>
                        </div>
                        <textarea 
                            id="message-input" 
                            placeholder="어떤 프롬프트를 만들고 싶으신가요? (Shift + Enter로 줄바꿈)"
                            rows="1"
                        ></textarea>
                        <button type="submit" class="btn-send" id="send-btn">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M22 2L11 13M22 2L15 22L11 13M22 2L2 9L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <!-- 설정 모달 -->
    <div class="modal" id="settings-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>설정</h2>
                <button class="btn-close" id="close-settings">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body settings-body">
                <div class="settings-layout">
                    <div class="settings-nav" id="settings-nav">
                        <button class="settings-tab active" data-settings-target="general">일반</button>
                        <button class="settings-tab" data-settings-target="memory">메모리</button>
                        <button class="settings-tab" data-settings-target="account">계정</button>
                    </div>
                    <div class="settings-panels">
                        <section class="settings-panel active" data-settings-panel="general">
                            <form id="settings-form">
                                <div class="form-group">
                                    <label for="openai-api-key">OpenAI API Key</label>
                                    <input type="password" id="openai-api-key" placeholder="sk-..." name="openai-api-key" autocomplete="off">
                                    <p class="help-text">API 키는 브라우저에만 저장되며 외부로 전송되지 않습니다</p>
                                </div>
                                <button class="btn-secondary" id="edit-profile-btn" type="button">사용자 설문 다시하기</button>
                                <button class="btn-primary" id="save-settings" type="button">저장</button>
                            </form>
                        </section>
                        <section class="settings-panel" data-settings-panel="memory">
                            <form id="memory-form" class="memory-form">
                                <div class="form-group">
                                    <label for="memory-text">기억할 내용 추가</label>
                                    <textarea id="memory-text" rows="3" placeholder="사용자 선호나 컨텍스트를 적어주세요" required></textarea>
                                </div>
                                <button class="btn-primary" type="submit">메모리 추가</button>
                            </form>
                            <div class="memory-list" id="memory-list"></div>
                        </section>
                        <section class="settings-panel" data-settings-panel="account">
                            <p class="account-email" id="account-email"></p>
                            <button class="btn-secondary" type="button" id="settings-logout-btn">로그아웃</button>
                        </section>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 링크 첨부 모달 -->
    <div class="modal" id="github-attach-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>링크에서 가져오기</h2>
                <button type="button" class="btn-close" id="github-modal-close" aria-label="링크 첨부 닫기">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <form id="github-attach-form" class="github-attach-form">
                    <div class="form-group">
                        <label for="github-file-url">GitHub 파일 URL</label>
                        <input type="url" id="github-file-url" placeholder="https://github.com/owner/repo/blob/main/path/to/file.js" required>
                        <p class="help-text">퍼블릭 저장소의 blob/raw URL을 붙여넣어주세요.</p>
                    </div>
                    <div class="form-group">
                        <label for="github-file-ref">브랜치 혹은 커밋 (선택)</label>
                        <input type="text" id="github-file-ref" placeholder="URL에 포함된 값이 우선됩니다.">
                        <p class="help-text">URL에 브랜치가 없다면 여기 입력한 값으로 raw 파일을 불러옵니다.</p>
                    </div>
                    <div class="github-attach-status" id="github-attach-status" role="status" aria-live="polite"></div>
                    <div class="github-attach-actions">
                        <button type="button" class="btn-secondary" id="github-modal-cancel">취소</button>
                        <button type="submit" class="btn-primary" id="github-attach-submit">링크에서 불러오기</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- GitHub 레포지토리 첨부 모달 -->
    <div class="modal" id="github-repo-modal">
        <div class="modal-content wide-modal">
            <div class="modal-header">
                <div>
                    <h2>깃허브에서 가져오기</h2>
                    <p class="modal-subtitle">GitHub 계정을 연결하고 레포지토리를 선택하면 전체가 하나의 첨부로 추가됩니다.</p>
                </div>
                <button type="button" class="btn-close" id="github-repo-close" aria-label="깃허브 첨부 닫기">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body github-repo-body">
                <form id="github-repo-form" class="github-repo-form">
                    <div class="form-group">
                        <label for="github-token-input">GitHub Personal Access Token</label>
                        <input type="password" id="github-token-input" placeholder="ghp_..." name="github-token" autocomplete="off">
                        <p class="help-text">레포지토리 목록을 불러오려면 읽기 권한이 있는 토큰이 필요합니다. 브라우저에만 저장됩니다.</p>
                    </div>
                    <div class="github-repo-actions">
                        <button type="button" class="btn-secondary" id="github-token-clear">연결 해제</button>
                        <button type="submit" class="btn-primary" id="github-token-connect">연결</button>
                    </div>
                </form>
                <div class="github-repo-status" id="github-repo-status" role="status" aria-live="polite"></div>
                <div class="github-repo-list" id="github-repo-list"></div>
            </div>
        </div>
    </div>

    <!-- 요금제 모달 -->
    <div class="modal" id="pricing-modal">
        <div class="modal-content pricing-modal-content">
            <div class="modal-header">
                <h2>Pro로 업그레이드</h2>
                <button class="btn-close" id="close-pricing">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body pricing-body">
                <div class="billing-toggle">
                    <button class="billing-option active" data-billing-option="monthly">월간</button>
                    <button class="billing-option" data-billing-option="yearly">
                        연간
                        <span class="billing-badge">-17%</span>
                    </button>
                </div>
                <div class="pricing-grid">
                    <div class="plan-card" data-plan="free">
                        <div class="plan-header">
                            <span class="plan-tier">FREE</span>
                            <span class="plan-subtitle">무료 체험</span>
                        </div>
                        <div class="plan-price">
                            <span class="plan-amount" data-price-monthly="0원" data-price-yearly="0원">0원</span>
                            <span class="plan-period" data-period-monthly="/ 월" data-period-yearly="/ 월">/ 월</span>
                        </div>
                        <ul class="plan-features">
                            <li>기본 재작성 기능</li>
                            <li>일 10회 제한</li>
                            <li>커뮤니티 지원</li>
                        </ul>
                        <button class="plan-cta secondary">시작하기</button>
                    </div>
                    <div class="plan-card popular" data-plan="pro">
                        <div class="plan-tag">POPULAR</div>
                        <div class="plan-header">
                            <span class="plan-tier">Pro</span>
                            <span class="plan-subtitle" data-label-monthly="29,000원/ 월" data-label-yearly="288,000원/ 년">29,000원/ 월</span>
                        </div>
                        <div class="plan-price">
                            <span class="plan-amount" data-price-monthly="29,000원" data-price-yearly="288,000원">29,000원</span>
                            <span class="plan-period" data-period-monthly="/ 월" data-period-yearly="/ 년">/ 월</span>
                        </div>
                        <div class="plan-note" data-label-monthly="월간 결제" data-label-yearly="연간 결제 (17% 할인)">월간 결제</div>
                        <ul class="plan-features">
                            <li>무제한 재작성</li>
                            <li>우선 처리</li>
                            <li>고급 커스터마이징</li>
                            <li>API 액세스</li>
                        </ul>
                        <button class="plan-cta primary" onclick="location.href='pay.html'">구독하기</button>
                    </div>
                    <div class="plan-card" data-plan="enterprise">
                        <div class="plan-header">
                            <span class="plan-tier">ENTERPRISE</span>
                            <span class="plan-subtitle">기업용</span>
                        </div>
                        <div class="plan-price">
                            <span class="plan-amount" data-price-monthly="문의" data-price-yearly="문의">문의</span>
                            <span class="plan-period" data-period-monthly="" data-period-yearly=""></span>
                        </div>
                        <ul class="plan-features">
                            <li>맞춤형 통합</li>
                            <li>전담 매니저</li>
                            <li>SLA 보장</li>
                            <li>온프레미스 옵션</li>
                        </ul>
                        <button class="plan-cta secondary">문의하기</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 온보딩 설문 모달 -->
    <div class="modal onboarding-modal" id="onboarding-modal">
        <div class="modal-content onboarding-content">
            <div class="modal-header">
                <div>
                    <p class="modal-subtitle">몇 가지 질문만 선택하면 됩니다</p>
                    <h2>어떤 도움을 드릴까요?</h2>
                </div>
                <button class="btn-close" id="close-onboarding">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body onboarding-body">
                <div class="onboarding-questions" id="onboarding-questions"></div>
                <div class="onboarding-footer">
                    <span class="onboarding-hint">선택은 언제든 다시 바꿀 수 있어요</span>
                    <button class="btn-primary" id="submit-onboarding">시작하기</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 프로젝트 모달 -->
    <div class="modal" id="projects-modal">
        <div class="modal-content wide-modal">
            <div class="modal-header">
                <div>
                    <h2>프로젝트 폴더</h2>
                    <p class="modal-subtitle">채팅을 주제별로 그룹화하고 자료를 모아보세요</p>
                </div>
                <button class="btn-close" id="close-projects">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body projects-body">
                <form id="project-form" class="project-form">
                    <div class="form-group">
                        <label for="project-name">프로젝트 이름</label>
                        <input type="text" id="project-name" placeholder="예: 4월 캠페인" required>
                    </div>
                    <div class="form-group">
                        <label for="project-description">설명</label>
                        <textarea id="project-description" rows="2" placeholder="간단한 메모"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="project-files">공유 자료 업로드</label>
                        <input type="file" id="project-files" multiple>
                        <p class="help-text">파일은 브라우저에만 저장됩니다.</p>
                    </div>
                    <button class="btn-primary" type="submit">프로젝트 생성</button>
                </form>
                <div class="project-list" id="project-list"></div>
            </div>
        </div>
    </div>

    <!-- 라이브러리 모달 -->
    <div class="modal" id="library-modal">
        <div class="modal-content wide-modal">
            <div class="modal-header">
                <h2>라이브러리</h2>
                <button class="btn-close" id="close-library">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body library-body" id="library-list"></div>
        </div>
    </div>

    <!-- 탐색 모달 -->
    <div class="modal" id="gallery-modal">
        <div class="modal-content wide-modal">
            <div class="modal-header">
                <h2>탐색</h2>
                <button class="btn-close" id="close-gallery">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body gallery-body" id="gallery-list"></div>
        </div>
    </div>

    <!-- 첨부 파일 뷰어 -->
    <div class="attachment-viewer hidden" id="attachment-viewer">
        <div class="attachment-viewer-content" role="dialog" aria-modal="true">
            <div class="attachment-viewer-header">
                <div>
                    <div class="attachment-viewer-name" id="attachment-viewer-name"></div>
                    <div class="attachment-viewer-meta" id="attachment-viewer-meta"></div>
                </div>
                <button type="button" class="btn-close" id="attachment-viewer-close" aria-label="첨부 파일 닫기">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="attachment-viewer-body" id="attachment-viewer-body">
                <p class="attachment-viewer-placeholder">첨부 파일을 선택하면 미리보기가 여기 표시됩니다.</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
    <div class="context-menu hidden" id="chat-context-menu">
        <button type="button" data-chat-menu="rename">대화 이름 수정</button>
        <button type="button" data-chat-menu="delete">대화 삭제</button>
    </div>

    <script src="app.js"></script>
</body>
</html>
